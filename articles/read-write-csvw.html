<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Read and Write CSVW in R • csvwr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Read and Write CSVW in R">
<meta property="og:description" content="csvwr">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">csvwr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/read-write-csvw.html">Read and Write CSVW in R</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Robsteranium/csvwr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="read-write-csvw_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Read and Write CSVW in R</h1>
                        <h4 class="author">Robin Gower</h4>
            
            <h4 class="date">2021-06-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Robsteranium/csvwr/blob/master/vignettes/read-write-csvw.Rmd"><code>vignettes/read-write-csvw.Rmd</code></a></small>
      <div class="hidden name"><code>read-write-csvw.Rmd</code></div>

    </div>

    
    
<div id="what-is-csv-on-the-web" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-csv-on-the-web" class="anchor"></a>What is CSV on the Web?</h2>
<p>The W3C’s CSV on the Web Working Group produced a series of recommendations for working with tabular data on the web.</p>
<ul>
<li>The <a href="https://w3c.github.io/csvw/syntax/">Model for Tabular Data and Metadata on the Web</a> describes how to annotate tables with metadata, and how processing applications should locate metadata and parse annotated tables.</li>
<li>The <a href="https://w3c.github.io/csvw/metadata/">Metadata Vocabulary for Tabular Data</a> provides a specification for annotating tables with metadata at various levels, from groups of tables and how they relate to each other down to individual cells within a table.</li>
<li>This vocabulary provides a mapping so that annotated tables can be transform from CSV to other formats: <a href="https://w3c.github.io/csvw/csv2json/">csv2json</a> and <a href="https://w3c.github.io/csvw/csv2rdf/">csv2rdf</a>
</li>
</ul>
<p>The <code>csvwr</code> library implements parts of this standard in R. The overall goal of the project is to support reading and writing of annotated CSV tables, in order to ensure consistent processing and reduce the amount of manual work needed to parse and prepare data before it can be used in analysis.</p>
<p>Practically speaking, you annotate a csv file by providing an accompanying json document containing the metadata. We benefit from annotating tables with csvw benefit because:</p>
<ul>
<li>the csv dialect (i.e. the choice of field separator or quoting characters) is explicitly defined, helping to avoid parsing mistakes</li>
<li>columns can be given syntactically-valid variable names (while retaining human-readable labels for display)</li>
<li>cell types are declared, obviating the need to e.g. parse dates (and figure-out formatting strings)</li>
</ul>
<p>This package includes some example csv and json for you to explore. Here is the csv file:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://robsteranium.github.io/csvwr">csvwr</a></span>)

<span class="kw">compsci_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/csvwr_example.html">csvwr_example</a></span>(<span class="st">"computer-scientists.csv"</span>)

<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="kw">compsci_csv</span>),sep=<span class="st">"\n"</span>)
<span class="co">#&gt; Name,Date Of Birth</span>
<span class="co">#&gt; Barbara Liskov,1939-11-07</span>
<span class="co">#&gt; Evelyn Boyd Granville,1924-05-01</span>
<span class="co">#&gt; Ada Lovelace,1815-12-10</span>
</pre></div>
<p>Here is the annotation:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">compsci_json</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/csvwr_example.html">csvwr_example</a></span>(<span class="st">"computer-scientists.json"</span>)

<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="kw">compsci_json</span>),sep=<span class="st">"\n"</span>)
<span class="co">#&gt; {</span>
<span class="co">#&gt;   "@context": "http://www.w3.org/ns/csvw",</span>
<span class="co">#&gt;   "tables": [{</span>
<span class="co">#&gt;     "url": "computer-scientists.csv",</span>
<span class="co">#&gt;     "tableSchema": {</span>
<span class="co">#&gt;       "columns": [{</span>
<span class="co">#&gt;         "name": "name",</span>
<span class="co">#&gt;         "titles": "Name",</span>
<span class="co">#&gt;         "datatype": "string",</span>
<span class="co">#&gt;         "propertyUrl": "foaf:name"</span>
<span class="co">#&gt;       }, {</span>
<span class="co">#&gt;         "name": "dob",</span>
<span class="co">#&gt;         "titles": "Date of Birth",</span>
<span class="co">#&gt;         "datatype": "date",</span>
<span class="co">#&gt;         "propertyUrl": "schema:birthDate"</span>
<span class="co">#&gt;       }],</span>
<span class="co">#&gt;       "aboutUrl": "http://example.org/computer-scientsts/{#name}",</span>
<span class="co">#&gt;       "primaryKey": "name"</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;   }]</span>
<span class="co">#&gt; }</span>
</pre></div>
</div>
<div id="how-do-i-read-a-table-annotated-with-csvw" class="section level2">
<h2 class="hasAnchor">
<a href="#how-do-i-read-a-table-annotated-with-csvw" class="anchor"></a>How do I read a table annotated with CSVW?</h2>
<p>You can get up and running quickly using the <a href="../help/read_csvw_dataframe">read_csvw_dataframe</a> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_csvw_dataframe.html">read_csvw_dataframe</a></span>(<span class="kw">compsci_csv</span>, <span class="kw">compsci_json</span>)
</pre></div>
<p>This parses the csvw metadata, and uses that to parse and interpret the csv file. A data frame is returned with columns that are named and typed accordingly to the specifications in the table’s schema. Here you can see the “Date Of Birth” field has been given a syntactically valid variable name, and parsed into a date vector automatically:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">d</span>)
<span class="co">#&gt; tibble [3 × 2] (S3: tbl_df/tbl/data.frame)</span>
<span class="co">#&gt;  $ name: chr [1:3] "Barbara Liskov" "Evelyn Boyd Granville" "Ada Lovelace"</span>
<span class="co">#&gt;  $ dob : Date[1:3], format: "1939-11-07" "1924-05-01" ...</span>

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw">d</span>)
</pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">name</th>
<th align="left">dob</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Barbara Liskov</td>
<td align="left">1939-11-07</td>
</tr>
<tr class="even">
<td align="left">Evelyn Boyd Granville</td>
<td align="left">1924-05-01</td>
</tr>
<tr class="odd">
<td align="left">Ada Lovelace</td>
<td align="left">1815-12-10</td>
</tr>
</tbody>
</table>
<p>This function assumes that you’re only interested in one table, and that you don’t want to work with the csvw metadata itself. The metadata vocabulary allows us to describe groups of tables (useful for lookup tables). You can get the table and annotations using the <a href="../help/read_csvw">read_csvw</a> function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">csvw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_csvw.html">read_csvw</a></span>(<span class="kw">compsci_csv</span>, <span class="kw">compsci_json</span>)
</pre></div>
<p>This returns a nested list, which broadly follows the structure of the csvw metadata.</p>
<p>As you can see from the json above, the <code>tables</code> element provides a list of tables and the annotation for each table provides a <code>url</code> (this can be used to locate csv files from the json metadata alone) and a <code>tableSchema</code>.</p>
<p>Within the <code>tableSchema</code> we have annotations for each column. We parse these into a data frame (instead of a list of lists which is how the <code>jsonlite</code> library would ordinarily interpret a json array of objects). This is much more idiomatic for manipulation in R.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">csvw</span><span class="op">$</span><span class="kw">tables</span>[[<span class="fl">1</span>]]<span class="op">$</span><span class="kw">tableSchema</span><span class="op">$</span><span class="kw">columns</span>
<span class="co">#&gt; # A tibble: 2 x 5</span>
<span class="co">#&gt;   name  titles        datatype  propertyUrl      required</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;         &lt;list&gt;    &lt;chr&gt;            &lt;lgl&gt;   </span>
<span class="co">#&gt; 1 name  Name          &lt;chr [1]&gt; foaf:name        FALSE   </span>
<span class="co">#&gt; 2 dob   Date of Birth &lt;chr [1]&gt; schema:birthDate FALSE</span>
</pre></div>
<p>We also introduce another element to each table, named <code>dataframe</code>. This provides the result of parsing the csv table using the schema provided in the json:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">csvw</span><span class="op">$</span><span class="kw">tables</span>[[<span class="fl">1</span>]]<span class="op">$</span><span class="kw">dataframe</span>
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   name                  dob       </span>
<span class="co">#&gt;   &lt;chr&gt;                 &lt;date&gt;    </span>
<span class="co">#&gt; 1 Barbara Liskov        1939-11-07</span>
<span class="co">#&gt; 2 Evelyn Boyd Granville 1924-05-01</span>
<span class="co">#&gt; 3 Ada Lovelace          1815-12-10</span>
</pre></div>
<p>The function <a href="../help/read_csvw_dataframe">read_csvw_dataframe</a> is just a convience wrapper for calling <a href="../help/read_csvw">read_csvw</a> and extracting this data frame.</p>
</div>
<div id="how-do-i-create-csvw-table-annotations" class="section level2">
<h2 class="hasAnchor">
<a href="#how-do-i-create-csvw-table-annotations" class="anchor"></a>How do I create CSVW table annotations?</h2>
<p>You can of course write json metadata by hand, but if you already have your table as a data frame in R then we can use this to get a head start.</p>
<p>If you provide the <a href="../help/derive_table_schema">derive_table_schema</a> function with a data frame it will prepare some table annotations.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(x=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>), y=<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>)
<span class="kw">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/derive_table_schema.html">derive_table_schema</a></span>(<span class="kw">d</span>)
</pre></div>
<p>You can then pass this to <a href="../help/create_metadata">create_metadata</a> to build up a complete annotation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
(<span class="kw">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_metadata.html">create_metadata</a></span>(tables=<span class="kw">s</span>))
<span class="co">#&gt; $`@context`</span>
<span class="co">#&gt; [1] "http://www.w3.org/ns/csvw"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tables</span>
<span class="co">#&gt; $tables$columns</span>
<span class="co">#&gt;   name titles datatype</span>
<span class="co">#&gt; 1    x      x   string</span>
<span class="co">#&gt; 2    y      y  integer</span>
</pre></div>
<p>This can then be serialised to JSON:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">j</span> <span class="op">&lt;-</span> <span class="kw">jsonlite</span>::<span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">toJSON</a></span>(<span class="kw">m</span>)
<span class="kw">jsonlite</span>::<span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/prettify.html">prettify</a></span>(<span class="kw">j</span>)
<span class="co">#&gt; {</span>
<span class="co">#&gt;     "@context": [</span>
<span class="co">#&gt;         "http://www.w3.org/ns/csvw"</span>
<span class="co">#&gt;     ],</span>
<span class="co">#&gt;     "tables": {</span>
<span class="co">#&gt;         "columns": [</span>
<span class="co">#&gt;             {</span>
<span class="co">#&gt;                 "name": "x",</span>
<span class="co">#&gt;                 "titles": "x",</span>
<span class="co">#&gt;                 "datatype": "string"</span>
<span class="co">#&gt;             },</span>
<span class="co">#&gt;             {</span>
<span class="co">#&gt;                 "name": "y",</span>
<span class="co">#&gt;                 "titles": "y",</span>
<span class="co">#&gt;                 "datatype": "integer"</span>
<span class="co">#&gt;             }</span>
<span class="co">#&gt;         ]</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; </span>
</pre></div>
<p>This JSON may then be written to disk:</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="kw">j</span>, file=<span class="st">"metadata.json"</span>)
</pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://infonomics.ltd.uk">Robin Gower</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
